<!DOCTYPE html>
<html>
<head><title>Debug API Integration</title></head>
<body>
<h1>Debug: API vs localStorage</h1>
<button onclick="testLocalStorage()">Test localStorage (should work)</button>
<button onclick="testAPI()">Test API call (might fail)</button>
<div id="results"></div>

<script type="module">
// Import the mock SDK
import { base44 } from './mock-sdk/index-browser.js';

window.testLocalStorage = async function() {
    const resultsDiv = document.getElementById('results');
    try {
        console.log('Testing localStorage Exercise.list()...');
        const exercises = await base44.entities.Exercise.list();
        console.log('✅ localStorage result:', exercises);
        resultsDiv.innerHTML = `<h3>localStorage SUCCESS</h3><p>Found ${exercises.length} exercises</p>`;
    } catch (error) {
        console.error('❌ localStorage failed:', error);
        resultsDiv.innerHTML = `<h3>localStorage FAILED</h3><p>${error.message}</p>`;
    }
};

window.testAPI = async function() {
    const resultsDiv = document.getElementById('results');
    try {
        console.log('Testing direct API call...');
        
        // Test 1: Direct fetch to API
        const response = await fetch('http://localhost:5001/api/v1/exercises');
        console.log('Raw response:', response.status, response.statusText);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('✅ Raw API data:', data);
        
        // Test 2: Extract exercises properly
        const exercises = data.data?.exercises || data.exercises || data;
        console.log('✅ Extracted exercises:', exercises.length);
        
        resultsDiv.innerHTML = `
            <h3>API SUCCESS</h3>
            <p>Status: ${response.status}</p>
            <p>Found ${exercises.length} exercises</p>
            <pre>${JSON.stringify(exercises.slice(0, 1), null, 2)}</pre>
        `;
        
    } catch (error) {
        console.error('❌ API test failed:', error);
        resultsDiv.innerHTML = `<h3>API FAILED</h3><p>${error.message}</p><p>Check console for details</p>`;
    }
};
</script>

</body>
</html>